import{a as f,b as l}from"./chunk-5KVKQEGS.js";import{a,b as d,ba as s,ga as c,o as p,w as u}from"./chunk-3S6DEF7O.js";var r="https://visionboard-c0bc7-default-rtdb.firebaseio.com/",h="https://identitytoolkit.googleapis.com/v1/accounts:",g="AIzaSyDnTblq6EXRbk0k97MwoyNvI7zlpNFyfMY",I=`${h}signUp?key=${g}`,j=`${h}signInWithPassword?key=${g}`;var m=(()=>{class o{constructor(t){this.http=t}getRequest(t){return this.http.get(`${r}${t}.json`)}postRequest(t,e,i){return this.http.post(t,e,i)}patchRequest(t,e,i){return this.http.patch(t,e,i)}deleteRequest(t,e){return this.http.delete(t,e)}static{this.\u0275fac=function(e){return new(e||o)(c(l))}}static{this.\u0275prov=s({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var x=(()=>{class o{constructor(t){this.firebaseService=t,this.unreadCountSubject=new p(this.getInitialUnreadCount()),this.unreadCount$=this.unreadCountSubject.asObservable(),this.headers=new f({"Content-Type":"application/json"}),this.updateUnreadCount()}getNotifications(){return this.firebaseService.getRequest("notifications").pipe(u(t=>{if(t){let e=Object.keys(t).map(i=>a({id:i},t[i])).filter(i=>i.title).sort((i,n)=>new Date(n.time).getTime()-new Date(i.time).getTime());return this.updateUnreadCount(e),e}else return this.updateUnreadCount([]),[]}))}getInitialUnreadCount(){let t=localStorage.getItem("unreadCount");return t?parseInt(t,10):0}updateLocalStorageCount(t){localStorage.setItem("unreadCount",t.toString())}addNotification(t){if(!t||!t.title||!t.icon){console.error("Invalid notification data:",t);return}let e=d(a({},t),{time:new Date().toISOString(),read:!1});this.firebaseService.postRequest(`${r}notifications.json`,e,{headers:this.headers}).subscribe(()=>this.updateUnreadCount())}getNotificationById(t){return this.firebaseService.getRequest(`notifications/${t}.json`).pipe(u(e=>a({id:t},e)))}markAsRead(t){this.updateNotificationInLocalStorage(t,!0),this.firebaseService.patchRequest(`${r}notifications/${t}.json`,{read:!0},{headers:this.headers}).subscribe(()=>{console.log(`Notification ${t} marked as read.`),this.decreaseUnreadCount()},e=>{console.error("Error marking notification as read:",e)})}updateNotificationInLocalStorage(t,e){let i=this.getStoredNotifications(),n=i.findIndex(b=>b.id===t);n!==-1&&(i[n].read=e,localStorage.setItem("notifications",JSON.stringify(i)))}getStoredNotifications(){let t=localStorage.getItem("notifications");return t?JSON.parse(t):[]}decreaseUnreadCount(){let t=this.unreadCountSubject.getValue();if(t>0){let e=t-1;this.unreadCountSubject.next(e),this.updateLocalStorageCount(e)}}updateUnreadCount(t=[]){let e=t.filter(i=>!i.read).length;this.unreadCountSubject.next(e),this.updateLocalStorageCount(e)}static{this.\u0275fac=function(e){return new(e||o)(c(m))}}static{this.\u0275prov=s({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{r as a,I as b,j as c,m as d,x as e};
