import{a as d,b as h}from"./chunk-5KVKQEGS.js";import{a as s,b as u,ba as a,ga as c,o as p,w as n}from"./chunk-3S6DEF7O.js";var o="https://visionboard-c0bc7-default-rtdb.firebaseio.com/",l="https://identitytoolkit.googleapis.com/v1/accounts:",f="AIzaSyDnTblq6EXRbk0k97MwoyNvI7zlpNFyfMY",C=`${l}signUp?key=${f}`,S=`${l}signInWithPassword?key=${f}`;var b=(()=>{class r{constructor(t){this.http=t}getRequest(t){return this.http.get(`${o}${t}.json`)}postRequest(t,e,i){return this.http.post(t,e,i)}patchRequest(t,e,i){return this.http.patch(t,e,i)}deleteRequest(t,e){return this.http.delete(t,e)}static{this.\u0275fac=function(e){return new(e||r)(c(h))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var R=(()=>{class r{constructor(t){this.firebaseService=t,this.unreadCountSubject=new p(this.getInitialUnreadCount()),this.unreadCount$=this.unreadCountSubject.asObservable(),this.headers=new d({"Content-Type":"application/json"}),this.updateUnreadCount()}getNotifications(){return this.firebaseService.getRequest("notifications").pipe(n(t=>t?Object.keys(t).map(e=>s({id:e},t[e])).filter(e=>e.title).sort((e,i)=>new Date(i.time).getTime()-new Date(e.time).getTime()):[]))}getInitialUnreadCount(){let t=localStorage.getItem("unreadCount");return t?parseInt(t,10):0}updateLocalStorageCount(t){localStorage.setItem("unreadCount",t.toString())}addNotification(t){if(!t||!t.title||!t.icon){console.error("Invalid notification data:",t);return}let e=u(s({},t),{time:new Date().toISOString(),read:!1});this.firebaseService.postRequest(`${o}notifications.json`,e,{headers:this.headers}).subscribe(()=>this.updateUnreadCount())}getNotificationById(t){return this.firebaseService.getRequest(`notifications/${t}.json`).pipe(n(e=>s({id:t},e)))}markAsRead(t){this.firebaseService.patchRequest(`${o}notifications/${t}.json`,{read:!0},{headers:this.headers}).subscribe(()=>{console.log(`Notification ${t} marked as read.`),this.decreaseUnreadCount()},e=>{console.error("Error marking notification as read:",e)})}decreaseUnreadCount(){let t=this.unreadCountSubject.getValue();t>0&&(this.unreadCountSubject.next(t-1),this.updateLocalStorageCount(t-1))}updateUnreadCount(){this.getNotifications().pipe(n(t=>t.filter(e=>!e.read).length)).subscribe(t=>{this.unreadCountSubject.next(t),this.updateLocalStorageCount(t)})}static{this.\u0275fac=function(e){return new(e||r)(c(b))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{o as a,C as b,S as c,b as d,R as e};
